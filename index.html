<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  background: #000;
  margin: 0;
  overflow: hidden;
  font-family: monospace;
  text-align: center;
}

canvas {
  background: #031d47;
  display: block;
  margin: auto;
  border: 3px solid #00d1ff;
}

.menu {
  position: absolute;
  top: 35%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}

.btn {
  display: block;
  margin: 10px auto;
  padding: 12px 20px;
  border: 2px solid #00eaff;
  background: transparent;
  color: #00eaff;
  font-size: 18px;
  cursor: pointer;
}
.btn:hover {
  background: #00eaff;
  color: #000;
}

#connectBtn {
  position: absolute;
  top: 10px;
  right: 10px;
  background: #1662ff;
  color: #fff;
}

.hidden {display:none;}

.scoreTop {
  color: #00eaff;
  font-size: 18px;
  position: absolute;
  top: 10px;
  left: 10px;
}

#snakeHeadEye {
  display: none;
}
</style>
</head>

<body>

<div class="scoreTop">Score: <span id="score">0</span></div>
<button id="connectBtn" class="btn">Connect Wallet</button>

<div id="menu" class="menu">
  <h1 style="color:#00eaff">üêç BaseSnake üü¶</h1>
  <button class="btn" onclick="startGame()">Start Game</button>
  <button class="btn" onclick="alert('Swipe or WASD to move.\nCollect base tokens. Avoid walls & yourself.')">Tutorial</button>
  <button class="btn" onclick="alert('Leaderboard coming soon!')">Best Score</button>
</div>

<canvas id="gameCanvas" width="400" height="400"></canvas>

<script>
const cvs = document.getElementById("gameCanvas");
const ctx = cvs.getContext("2d");

let box = 20;
let snake = [{x: 9*box, y: 10*box}];
let food = {x: 5*box, y: 5*box};
let score = 0;
let d;
let blink = true;

// load Basecoin image
const coinImg = new Image();
coinImg.src = "basecoin.png";

// Input keys
document.addEventListener("keydown", direction);
function direction(e){
  if(e.key=="w" && d!="DOWN") d="UP";
  else if(e.key=="s" && d!="UP") d="DOWN";
  else if(e.key=="a" && d!="RIGHT") d="LEFT";
  else if(e.key=="d" && d!="LEFT") d="RIGHT";
  else if(e.key=="ArrowUp" && d!="DOWN") d="UP";
  else if(e.key=="ArrowDown" && d!="UP") d="DOWN";
  else if(e.key=="ArrowLeft" && d!="RIGHT") d="LEFT";
  else if(e.key=="ArrowRight" && d!="LEFT") d="RIGHT";
}

// mobile swipe support
let sx, sy;
document.addEventListener("touchstart", e => {
  sx = e.touches[0].clientX;
  sy = e.touches[0].clientY;
});
document.addEventListener("touchmove", e => {
  if(!sx || !sy) return;
  let dx = e.touches[0].clientX - sx;
  let dy = e.touches[0].clientY - sy;

  if(Math.abs(dx) > Math.abs(dy)) {
    if(dx > 0 && d!="LEFT") d="RIGHT";
    else if(dx < 0 && d!="RIGHT") d="LEFT";
  } else {
    if(dy > 0 && d!="UP") d="DOWN";
    else if(dy < 0 && d!="DOWN") d="UP";
  }
  sx=sy=null;
});

// draw
function draw(){
  ctx.fillStyle = "#001c44";
  ctx.fillRect(0,0,400,400);

  // draw snake
  for(let i=0;i<snake.length;i++){
    ctx.fillStyle = i==0 ? "#00ffea" : "#009b9b";
    ctx.fillRect(snake[i].x, snake[i].y, box, box);

    // blinking eyes for head
    if(i==0 && blink){
      ctx.fillStyle="#000";
      ctx.fillRect(snake[i].x+5, snake[i].y+5,4,4);
      ctx.fillRect(snake[i].x+11, snake[i].y+5,4,4);
    }
  }

  // coin
  ctx.drawImage(coinImg, food.x, food.y, box, box);

  // movement
  let head = {x: snake[0].x, y: snake[0].y};
  if(d=="LEFT") head.x-=box;
  if(d=="RIGHT") head.x+=box;
  if(d=="UP") head.y-=box;
  if(d=="DOWN") head.y+=box;

  // collision
  if(head.x<0||head.x>=400||head.y<0||head.y>=400||collision(head,snake)){
    clearInterval(game);
    alert("Game Over!");
    location.reload();
  }

  snake.unshift(head);

  if(head.x==food.x && head.y==food.y){
    score++;
    document.getElementById("score").innerText = score;
    food = {
      x: Math.floor(Math.random()*20)*box,
      y: Math.floor(Math.random()*20)*box
    };
  } else snake.pop();
}

function collision(h,s){
  for(let i=1;i<s.length;i++){
    if(h.x==s[i].x && h.y==s[i].y) return true;
  }
  return false;
}

let game;
setInterval(()=>blink=!blink,300);

function startGame(){
  document.getElementById("menu").classList.add("hidden");
  game=setInterval(draw,150);
}
</script>
</body>
</html>
