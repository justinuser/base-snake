const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

canvas.width = 400;
canvas.height = 400;

let snake = [{x:200,y:200}];
let food = randomFood();
let direction = "RIGHT";
let game;
let mute = false;

document.getElementById("startBtn").onclick = startGame;
document.getElementById("retryBtn").onclick = startGame;
document.getElementById("pauseBtn").onclick = () => clearInterval(game);
document.getElementById("muteBtn").onclick = () => mute = !mute;

document.addEventListener("keydown", e => {
  if(e.key==="w") direction="UP";
  if(e.key==="a") direction="LEFT";
  if(e.key==="s") direction="DOWN";
  if(e.key==="d") direction="RIGHT";
});

function startGame(){
  document.getElementById("menu").style.display="none";
  document.getElementById("gameCanvas").style.display="block";
  document.getElementById("ui").style.display="block";

  snake = [{x:200,y:200}];
  direction="RIGHT";
  food = randomFood();

  game = setInterval(update,150);
}

function randomFood(){
  return {
    x: Math.floor(Math.random()*20)*20,
    y: Math.floor(Math.random()*20)*20
  };
}

function update(){
  let head = {...snake[0]};
  if(direction==="UP") head.y -=20;
  if(direction==="DOWN") head.y +=20;
  if(direction==="LEFT") head.x -=20;
  if(direction==="RIGHT") head.x +=20;

  // âœ… Hit wall = end (wall visible now)
  if(head.x<0||head.x>=400||head.y<0||head.y>=400){
    clearInterval(game);
    alert("Game Over");
    return;
  }

  snake.unshift(head);

  if(head.x===food.x && head.y===food.y){
    food = randomFood();
  } else {
    snake.pop();
  }

  draw();
}

function draw(){
  ctx.fillStyle="black";
  ctx.fillRect(0,0,400,400);

  // Draw Snake
  ctx.fillStyle="#0f0";
  snake.forEach((s,i)=>{
    ctx.fillRect(s.x,s.y,20,20);
  });

  // Draw BaseCoin food
  let img = new Image();
  img.src="basecoin.png";
  ctx.drawImage(img,food.x,food.y,20,20);
}
